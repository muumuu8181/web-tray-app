<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Code Tray App v1.02</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 100%;  /* 開発時は画面幅に合わせる */
            min-width: 900px; /* 最小幅を確保 */
            height: 800px;
            overflow: hidden;
            font-size: 14px; /* フォントサイズも大きく */
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .version {
            font-size: 10px;
            opacity: 0.8;
        }

        .tabs {
            display: flex;
            background: rgba(0, 0, 0, 0.2);
        }

        .tab {
            flex: 1;
            padding: 8px 4px;
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 10px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .tab:last-child {
            border-right: none;
        }

        .tab.active {
            background: rgba(255, 255, 255, 0.3);
            color: #fff;
        }

        .tab:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .tab-content {
            display: none;
            padding: 10px 8px;
            height: calc(100vh - 80px);
            overflow-y: auto;
        }

        .tab-content.active {
            display: block;
        }

        .section {
            margin-bottom: 15px;
        }

        .section-title {
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #ffd700;
            border-bottom: 1px solid rgba(255, 215, 0, 0.3);
            padding-bottom: 2px;
        }

        .button {
            width: 100%;
            padding: 8px 6px;
            margin-bottom: 6px;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            color: white;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .button:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-1px);
        }

        .button:active {
            background: rgba(255, 255, 255, 0.4);
            transform: translateY(1px);
        }

        .button.clicked {
            background: rgba(0, 255, 0, 0.3) !important;
            border: 2px solid #00ff00 !important;
            animation: buttonSuccess 0.6s ease;
        }

        @keyframes buttonSuccess {
            0% { background: rgba(0, 255, 0, 0.8); }
            100% { background: rgba(255, 255, 255, 0.15); }
        }

        .quick-note {
            width: 100%;
            height: 60px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            color: white;
            font-size: 10px;
            padding: 6px;
            resize: none;
            font-family: inherit;
        }

        .quick-note::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .yarakashi-item {
            background: rgba(255, 0, 0, 0.1);
            border-left: 3px solid #ff6b6b;
            padding: 6px;
            margin-bottom: 6px;
            border-radius: 0 4px 4px 0;
            font-size: 9px;
            cursor: pointer;
        }

        .yarakashi-item:hover {
            background: rgba(255, 0, 0, 0.2);
        }

        .yarakashi-date {
            color: #ff9999;
            font-size: 8px;
            margin-bottom: 2px;
        }

        .scrollbar {
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
        }

        .scrollbar::-webkit-scrollbar {
            width: 4px;
        }

        .scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div>Claude Code Helper</div>
        <div class="version">v1.02</div>
    </div>

    <div class="tabs">
        <div class="tab active" onclick="switchTab('claude-tab')">Claude</div>
        <div class="tab" onclick="switchTab('yarakashi-tab')">やらかし</div>
    </div>

    <!-- Claude Code Tab -->
    <div id="claude-tab" class="tab-content active scrollbar">
        <div class="section">
            <div class="section-title">📝 プロンプト</div>
            <button class="button" onclick="copyToClipboard('debug-prompt')">デバッグ分析</button>
            <button class="button" onclick="copyToClipboard('refactor-prompt')">リファクタ</button>
            <button class="button" onclick="copyToClipboard('explain-prompt')">コード説明</button>
            <button class="button" onclick="copyToClipboard('test-prompt')">テスト作成</button>
        </div>

        <div class="section">
            <div class="section-title">⚡ クイック</div>
            <button class="button" onclick="quickAction('todo')">TODO追加</button>
            <button class="button" onclick="quickAction('commit')">コミット</button>
            <button class="button" onclick="quickAction('status')">ステータス</button>
            <button class="button" onclick="quickAction('diff')">差分確認</button>
        </div>

        <div class="section">
            <div class="section-title">📋 メモ</div>
            <textarea class="quick-note scrollbar" placeholder="クイックメモ..."></textarea>
        </div>
    </div>

    <!-- やらかしリスト Tab -->
    <div id="yarakashi-tab" class="tab-content scrollbar">
        <div class="section">
            <div class="section-title">⚠️ やらかしリスト</div>
            <button class="button" onclick="addYarakashi()">新規追加</button>
            <div id="yarakashi-list">
                <div class="yarakashi-item" onclick="editYarakashi(0)">
                    <div class="yarakashi-date">2025-08-23</div>
                    <div>Tkinter初期化順序問題</div>
                </div>
                <div class="yarakashi-item" onclick="editYarakashi(1)">
                    <div class="yarakashi-date">2025-08-22</div>
                    <div>システムトレイ実装でスレッド競合</div>
                </div>
                <div class="yarakashi-item" onclick="editYarakashi(2)">
                    <div class="yarakashi-date">2025-08-21</div>
                    <div>段階的実装を怠った</div>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">💡 対策メモ</div>
            <textarea class="quick-note scrollbar" placeholder="対策・学習内容..."></textarea>
        </div>
    </div>

    <script>
        // タブ切り替え
        function switchTab(tabId) {
            // 全てのタブとコンテンツを非アクティブ化
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // 選択されたタブとコンテンツをアクティブ化
            event.target.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        // プロンプトテンプレート
        const prompts = {
            'debug-prompt': 'このエラーを分析して解決方法を提案してください：\n\n',
            'refactor-prompt': 'このコードをリファクタリングして、可読性と保守性を向上させてください：\n\n',
            'explain-prompt': 'このコードの動作を詳しく説明してください：\n\n',
            'test-prompt': 'この関数のユニットテストを作成してください：\n\n'
        };

        // クリップボードにコピー
        function copyToClipboard(promptType) {
            const text = prompts[promptType];
            
            // ボタンにクリック効果を追加
            const button = event.target;
            button.classList.add('clicked');
            setTimeout(() => button.classList.remove('clicked'), 600);
            
            try {
                // Electron環境でのクリップボード操作
                const { clipboard } = window.require('electron');
                clipboard.writeText(text);
                showNotification('✅ クリップボードにコピーしました: ' + promptType);
                console.log('✅ Copied to clipboard:', promptType, 'Text:', text.substring(0, 50) + '...');
            } catch (error) {
                console.error('❌ Clipboard error:', error);
                showNotification('❌ コピーに失敗しました');
                
                // フォールバック: navigator.clipboard
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(text).then(() => {
                        showNotification('✅ クリップボードにコピーしました (fallback): ' + promptType);
                    }).catch(() => {
                        showNotification('❌ コピーに完全に失敗しました');
                    });
                }
            }
        }

        // クイックアクション
        function quickAction(action) {
            const actions = {
                'todo': 'TODO: ',
                'commit': 'git commit -m ""',
                'status': 'git status',
                'diff': 'git diff'
            };
            
            // ボタンにクリック効果を追加
            const button = event.target;
            button.classList.add('clicked');
            setTimeout(() => button.classList.remove('clicked'), 600);
            
            try {
                const { clipboard } = window.require('electron');
                clipboard.writeText(actions[action]);
                showNotification('✅ ' + action + ' コマンドをコピーしました');
                console.log('✅ Quick action copied:', action, 'Command:', actions[action]);
            } catch (error) {
                console.error('❌ Quick action error:', error);
                showNotification('❌ コピーに失敗しました');
                
                // フォールバック: navigator.clipboard
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(actions[action]).then(() => {
                        showNotification('✅ ' + action + ' コマンドをコピーしました (fallback)');
                    }).catch(() => {
                        showNotification('❌ コピーに完全に失敗しました');
                    });
                }
            }
        }

        // やらかし追加
        function addYarakashi() {
            const title = prompt('やらかし内容を入力してください:');
            if (title) {
                const today = new Date().toISOString().split('T')[0];
                const listElement = document.getElementById('yarakashi-list');
                const newItem = document.createElement('div');
                newItem.className = 'yarakashi-item';
                newItem.innerHTML = '<div class="yarakashi-date">' + today + '</div><div>' + title + '</div>';
                listElement.insertBefore(newItem, listElement.firstChild);
            }
        }

        // やらかし編集
        function editYarakashi(index) {
            alert('やらかし詳細編集機能（今後実装予定）');
        }

        // 通知表示
        function showNotification(message) {
            console.log('🔔 Notification:', message);
            
            // 簡易通知（より見やすく改良）
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 15px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(0, 0, 0, 0.9);
                color: white;
                padding: 8px 12px;
                border-radius: 6px;
                font-size: 11px;
                font-weight: bold;
                z-index: 1000;
                box-shadow: 0 2px 10px rgba(0,0,0,0.3);
                animation: slideDown 0.3s ease;
            `;
            document.body.appendChild(notification);
            
            // 通知にスライドダウンアニメーションを追加
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideDown {
                    from { opacity: 0; transform: translateX(-50%) translateY(-20px); }
                    to { opacity: 1; transform: translateX(-50%) translateY(0); }
                }
            `;
            document.head.appendChild(style);
            
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
                if (document.head.contains(style)) {
                    document.head.removeChild(style);
                }
            }, 3000);
        }

        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Claude Code Tray App loaded');
        });
    </script>
</body>
</html>